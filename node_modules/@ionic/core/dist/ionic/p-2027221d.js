/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */
import{w as o,d as t}from"./p-7b30edcc.js";import{g as n,c as i,f as a}from"./p-e7309bfa.js";import{a as r,b as e,r as s,c as d}from"./p-b9ea58ef.js";import{a as c,K as l}from"./p-27281edd.js";import"./p-3f4327f7.js";import"./p-597ff9af.js";import"./p-66a5d6a8.js";import"./p-c61cc894.js";const u=new WeakMap,f=(o,t,n,i=0,a=!1)=>{u.has(o)!==n&&(n?p(o,t,i,a):w(o,t))},p=(o,t,n,i=!1)=>{const a=t.parentNode,r=t.cloneNode(!1);r.classList.add("cloned-input"),r.tabIndex=-1,i&&(r.disabled=!0),a.appendChild(r),u.set(o,r);const e="rtl"===o.ownerDocument.dir?9999:-9999;o.style.pointerEvents="none",t.style.transform=`translate3d(${e}px,${n}px,0) scale(0)`},w=(o,t)=>{const n=u.get(o);n&&(u.delete(o),n.remove()),o.style.pointerEvents="",t.style.transform=""},m="input, textarea, [no-blur], [contenteditable]",b="$ionPaddingTimer",h=(o,t,n)=>{const i=o[b];i&&clearTimeout(i),t>0?o.style.setProperty("--keyboard-offset",`${t}px`):o[b]=setTimeout((()=>{o.style.setProperty("--keyboard-offset","0px"),n&&n()}),120)},y=(o,t,n)=>{o.addEventListener("focusout",(()=>{t&&h(t,0,n)}),{once:!0})};let S=0;const D="data-ionic-skip-scroll-assist",v=o=>{document.activeElement!==o&&(o.setAttribute(D,"true"),o.focus())},K=async(o,t,a,r,e,d,c=!1,l=0,u=!0)=>{if(!a&&!r)return;const p=((o,t,n,i)=>{var a;return((o,t,n,i)=>{const a=o.top,r=o.bottom,e=t.top,s=e+15,d=Math.min(t.bottom,i-n)-50-r,c=s-a,l=Math.round(d<0?-d:c>0?-c:0),u=Math.min(l,a-e),f=Math.abs(u);return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,f/.3)),scrollPadding:n,inputSafeY:4-(a-s)}})((null!==(a=o.closest("ion-item,[ion-item]"))&&void 0!==a?a:o).getBoundingClientRect(),t.getBoundingClientRect(),n,i)})(o,a||r,e,l);if(a&&Math.abs(p.scrollAmount)<4)return v(t),void(d&&null!==a&&(h(a,S),y(t,a,(()=>S=0))));if(f(o,t,!0,p.inputSafeY,c),v(t),s((()=>o.click())),d&&a&&(S=p.scrollPadding,h(a,S)),"undefined"!=typeof window){let r;const e=async()=>{void 0!==r&&clearTimeout(r),window.removeEventListener("ionKeyboardDidShow",s),window.removeEventListener("ionKeyboardDidShow",e),a&&await i(a,0,p.scrollAmount,p.scrollDuration),f(o,t,!1,p.inputSafeY),v(t),d&&y(t,a,(()=>S=0))},s=()=>{window.removeEventListener("ionKeyboardDidShow",s),window.addEventListener("ionKeyboardDidShow",e)};if(a){const o=await n(a);if(u&&p.scrollAmount>o.scrollHeight-o.clientHeight-o.scrollTop)return"password"===t.type?(p.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",s)):window.addEventListener("ionKeyboardDidShow",e),void(r=setTimeout(e,1e3))}e()}},M=async(n,i)=>{if(void 0===t)return;const s="ios"===i,u="android"===i,p=n.getNumber("keyboardHeight",290),w=n.getBoolean("scrollAssist",!0),b=n.getBoolean("hideCaretOnScroll",s),h=n.getBoolean("inputBlurring",!1),y=n.getBoolean("scrollPadding",!0),S=Array.from(t.querySelectorAll("ion-input, ion-textarea")),v=new WeakMap,M=new WeakMap,j=await l.getResizeMode(),x=async t=>{await new Promise((o=>d(t,o)));const n=t.shadowRoot||t,i=n.querySelector("input")||n.querySelector("textarea"),s=a(t),l=s?null:t.closest("ion-footer");if(i){if(s&&b&&!v.has(t)){const o=((o,t,n)=>{if(!n||!t)return()=>{};const i=n=>{var i;(i=t)===i.getRootNode().activeElement&&f(o,t,n)},a=()=>f(o,t,!1),s=()=>i(!0),d=()=>i(!1);return r(n,"ionScrollStart",s),r(n,"ionScrollEnd",d),t.addEventListener("blur",a),()=>{e(n,"ionScrollStart",s),e(n,"ionScrollEnd",d),t.removeEventListener("blur",a)}})(t,i,s);v.set(t,o)}if("date"!==i.type&&"datetime-local"!==i.type&&(s||l)&&w&&!M.has(t)){const n=((t,n,i,a,r,e,s,d=!1)=>{const l=e&&(void 0===s||s.mode===c.None);let u=!1;const f=void 0!==o?o.innerHeight:0,p=o=>{!1!==u?K(t,n,i,a,o.detail.keyboardHeight,l,d,f,!1):u=!0},w=()=>{u=!1,null==o||o.removeEventListener("ionKeyboardDidShow",p),t.removeEventListener("focusout",w)},m=async()=>{n.hasAttribute(D)?n.removeAttribute(D):(K(t,n,i,a,r,l,d,f),null==o||o.addEventListener("ionKeyboardDidShow",p),t.addEventListener("focusout",w))};return t.addEventListener("focusin",m),()=>{t.removeEventListener("focusin",m),null==o||o.removeEventListener("ionKeyboardDidShow",p),t.removeEventListener("focusout",w)}})(t,i,s,l,p,y,j,u);M.set(t,n)}}};h&&(()=>{let o=!0,t=!1;const n=document;r(n,"ionScrollStart",(()=>{t=!0})),n.addEventListener("focusin",(()=>{o=!0}),!0),n.addEventListener("touchend",(i=>{if(t)return void(t=!1);const a=n.activeElement;if(!a)return;if(a.matches(m))return;const r=i.target;r!==a&&(r.matches(m)||r.closest(m)||(o=!1,setTimeout((()=>{o||a.blur()}),50)))}),!1)})();for(const o of S)x(o);t.addEventListener("ionInputDidLoad",(o=>{x(o.detail)})),t.addEventListener("ionInputDidUnload",(o=>{(o=>{if(b){const t=v.get(o);t&&t(),v.delete(o)}if(w){const t=M.get(o);t&&t(),M.delete(o)}})(o.detail)}))};export{M as startInputShims}